CLEAN_LIST=$(OBJECTS)
TOPDIR=../../../..
INCLUDE_FLAGS=-I. -I$(TOPDIR)/lib -I$(TOPDIR)/lib/sys

CXX=g++
CXXFLAGS=-std=c++98 -Wall $(INCLUDE_FLAGS)
LINK=$(CXX)

LIBRARY_OBJECTS=$(TOPDIR)/lib/sys/IniDocument.o \
$(TOPDIR)/lib/sys/debug.o
CLEAN_LIST+=$(LIBRARY_OBJECTS)

TESTGEN=cxxtestgen
TESTOPT=--error-printer --have-eh
TESTS=TestUtil.h TestParams.h TestIniParser.h
TEST_TARGET=tests
TEST_RUNNER_CPPFILE=$(TEST_TARGET).cpp
CLEAN_LIST+=$(TEST_TARGET) $(TEST_RUNNER_CPPFILE)

all: $(TEST_TARGET)

Params.o: Params.cpp Params.h
OBJECTS+=Params.o



$(TEST_RUNNER_CPPFILE): $(TESTS)
	$(TESTGEN) -o $@ $(TESTOPT) $(TESTS)

$(TEST_TARGET): $(TEST_RUNNER_CPPFILE) $(LIBRARY_OBJECTS) $(OBJECTS)
	$(LINK) $(CXXFLAGS) -o $@ $^

$(TOPDIR)/lib/sys/IniDocument.o: $(TOPDIR)/lib/sys/IniDocument.h \
$(TOPDIR)/lib/sys/IniDocument.cpp


TestIniParser.h: IniParser.h

IniParser.h: IniParser.rl
	ragel $^ -o $@
CLEAN_LIST+=IniParser.h
clean:
	rm -f $(CLEAN_LIST)
