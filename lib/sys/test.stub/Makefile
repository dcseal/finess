# Current status:
# - All build configuration are broken.  So this Makefile is not
#   expected to build anything as it currently stands.
# - This Makefile was used in a development environment.
# - IniParams.cpp and IniParams.h are supposed to be generated by an
#   old version of generate_iniparams.py, which is now gone from
#   working-tree.  So TestParams.h are expected to fail to compile as
#   it currently stands;
# - TestParser.h is in good shape.  It is expected to pass, provided
#   it is correctly built;
# - So is TestUtil.h

none:
	@echo "Nothing is being built.  See comments in Makefile."

CLEAN_LIST=$(OBJECTS)
TOPDIR=../../../..
INCLUDE_FLAGS=-I. -I$(TOPDIR)/lib -I$(TOPDIR)/lib/sys

CXX=g++
CXXFLAGS=-std=c++98 -Wall $(INCLUDE_FLAGS)
LINK=$(CXX)

CLEAN_LIST+=$(LIBRARY_OBJECTS)

TESTGEN=cxxtestgen
TESTOPT=--error-printer --have-eh
TESTS=TestUtil.h TestParams.h TestIniParser.h
TEST_TARGET=tests
TEST_RUNNER_CPPFILE=$(TEST_TARGET).cpp
CLEAN_LIST+=$(TEST_TARGET) $(TEST_RUNNER_CPPFILE)

all: $(TEST_TARGET)

IniParams.o: IniParams.cpp IniParams.h
OBJECTS+=IniParams.o



$(TEST_RUNNER_CPPFILE): $(TESTS)
	$(TESTGEN) -o $@ $(TESTOPT) $(TESTS)

$(TEST_TARGET): $(TEST_RUNNER_CPPFILE) $(LIBRARY_OBJECTS) $(OBJECTS)
	$(LINK) $(CXXFLAGS) -o $@ $^



TestIniParser.h: IniParser.h

IniParser.h: IniParser.rl
	ragel $^ -o $@
CLEAN_LIST+=IniParser.h
clean:
	rm -f $(CLEAN_LIST)
